<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Family Money｜家計かんたん診断</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- jsPDF（PDF出力用）CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: "Noto Sans JP", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
      background: #faf8f5;
      padding: 24px;
      line-height: 1.6;
      color: #333;
    }

    h1 {
      font-size: 24px;
      text-align: center;
      margin-bottom: 8px;
    }

    .sub-title {
      text-align: center;
      font-size: 13px;
      color: #777;
      margin-bottom: 20px;
    }

    .layout {
      max-width: 960px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.9fr);
      gap: 16px;
      align-items: flex-start;
    }

    @media (max-width: 768px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0px 4px 12px rgba(0,0,0,0.08);
      border: 1px solid #eee0cf;
    }

    .section-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #f5e3cc;
      color: #b57a3f;
      font-weight: 600;
    }

    label {
      font-weight: 600;
      margin-top: 12px;
      display: block;
      font-size: 13px;
    }

    .hint {
      font-size: 11px;
      color: #777;
    }

    input {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 14px;
      background: #fdfaf6;
    }

    input:focus {
      outline: none;
      border-color: #f2a25c;
      box-shadow: 0 0 0 2px rgba(242,162,92,0.25);
      background: #fff;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 10px;
    }

    @media (max-width: 600px) {
      .grid-2 {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .group-box {
      margin-top: 16px;
      padding: 12px 12px 10px;
      border-radius: 12px;
      border: 1px dashed #e0d3c2;
      background: #fdf9f3;
    }

    .group-title {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .group-tag {
      font-size: 11px;
      padding: 1px 7px;
      border-radius: 999px;
      background: #f7e6cf;
      color: #a16b2f;
      font-weight: 600;
    }

    button {
      width: 100%;
      margin-top: 16px;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-main {
      background: #f4a460;
      color: white;
    }

    .btn-reset {
      background: #e3ded8;
      color: #444;
    }

    /* 右側：結果カード（stickyやめる） */
    .result-card {
      margin-bottom: 16px;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .pill {
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid #e0d3c2;
      background: #fdfaf6;
      white-space: nowrap;
    }

    .pill-green {
      border-color: #4e9b6a;
      color: #2d6d44;
      background: #ecf7f0;
    }

    .pill-yellow {
      border-color: #e8b249;
      color: #9a720e;
      background: #fff7df;
    }

    .pill-red {
      border-color: #d66a6a;
      color: #8c2f2f;
      background: #ffecec;
    }

    /* メインの貯蓄額を強調 */
    .saving-rate {
      font-size: 28px;
      font-weight: 800;
      margin: 4px 0 4px;
    }

    .rate-good { color: #2e8b57; }
    .rate-mid  { color: #d29122; }
    .rate-bad  { color: #c64545; }

    .metric-note {
      font-size: 12px;
      color: #777;
      margin-bottom: 8px;
    }

    .compare-box {
      margin-top: 8px;
      padding: 10px 12px;
      border-radius: 10px;
      background: #fff;
      border: 1px solid #eee0cf;
      font-size: 12px;
    }

    .compare-row {
      display: grid;
      grid-template-columns: 1.3fr 1fr 1fr;
      gap: 6px;
      align-items: center;
      margin-bottom: 4px;
    }

    .compare-row.header {
      font-weight: 700;
      border-bottom: 1px solid #f0e3d5;
      padding-bottom: 3px;
      margin-bottom: 6px;
      font-size: 12px;
    }

    .compare-label {
      color: #555;
      font-weight: 600;
    }

    .compare-your {
      font-weight: 700;
      font-size: 13px;
    }

    .compare-aoki {
      font-weight: 700;
      color: #6e5b3a;
      font-size: 12px;
    }

    .result-title {
      font-weight: 700;
      margin-top: 12px;
      font-size: 15px;
    }

    .message {
      margin-top: 6px;
      font-size: 13px;
    }

    .small-note {
      margin-top: 8px;
      font-size: 11px;
      color: #888;
    }

    .actions-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .btn-sub {
      width: auto;
      padding: 8px 14px;
      font-size: 13px;
      background: #fff;
      border: 1px solid #e0d3c2;
      color: #555;
      border-radius: 999px;
      cursor: pointer;
    }

    /* 青木家モデル用カード（右下・赤枠エリア） */
    .aoki-card {
      margin-bottom: 16px;
      border-style: dashed;
      border-color: #f4a460;
      background: #fffaf2;
    }

    .aoki-summary {
      font-size: 12px;
      color: #555;
      margin-bottom: 10px;
    }

    .aoki-numbers {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 8px;
    }

    .aoki-number-block {
      flex: 1 1 120px;
      min-width: 0;
    }

    .aoki-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }

    .aoki-amount {
      font-size: 22px;
      font-weight: 800;
      color: #2e8b57;
    }

    .aoki-amount-sub {
      font-size: 16px;
      font-weight: 700;
      color: #6e5b3a;
    }

    /* 保存・メール用のカード（別タブ的な別枠） */
    .share-card-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .share-card-note {
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }
  </style>
</head>

<body>
  <h1>Family Money｜家計かんたん診断</h1>
  <p class="sub-title">40代・晩産夫婦向け。「いまの家計バランス」と「青木家の例」を同じ収入で比較できます。</p>

  <div class="layout">
    <!-- 左：入力カード -->
    <div class="card">
      <div class="section-title">
        毎月の家計をざっくり入力
        <span class="badge">1〜2分でOK</span>
      </div>

      <label>メールアドレス（結果を受け取りたい方のみ）</label>
      <input id="email" type="email" placeholder="例：family@example.com">
      <div class="hint">※ 入力しなくても診断はできます。</div>

      <label>① 手取り収入（月）</label>
      <input id="income" type="number" placeholder="例：350000">

      <label>①-2 ボーナス（年間・手取り）</label>
      <input id="bonus" type="number" placeholder="例：400000">

      <!-- 固定費グループ -->
      <div class="group-box">
        <div class="group-title">
          必要なお金（固定費）
          <span class="group-tag">家を守るための支出</span>
        </div>
        <div class="grid-2">
          <div>
            <label>② 家賃 / 住宅費</label>
            <input id="rent" type="number">
          </div>
          <div>
            <label>③ 光熱費</label>
            <input id="utility" type="number">
          </div>
        </div>
        <div class="grid-2">
          <div>
            <label>④ 通信費（スマホ・ネット）</label>
            <input id="phone" type="number">
          </div>
          <div>
            <label>⑤ 保険料</label>
            <input id="insurance" type="number">
          </div>
        </div>
      </div>

      <!-- 変動費グループ -->
      <div class="group-box">
        <div class="group-title">
          自由に使うお金（変動費）
          <span class="group-tag">暮らしを彩る支出</span>
        </div>
        <div class="grid-2">
          <div>
            <label>⑥ 食費</label>
            <input id="food" type="number">
          </div>
          <div>
            <label>⑦ 日用品</label>
            <input id="daily" type="number">
          </div>
        </div>
        <div class="grid-2">
          <div>
            <label>⑧ 子ども費</label>
            <input id="child" type="number">
          </div>
          <div>
            <label>⑨ その他の支出</label>
            <input id="other" type="number">
          </div>
        </div>
      </div>

      <button class="btn-main" onclick="calculateKakei()">家計を診断する</button>
      <button class="btn-reset" onclick="resetForm()">リセット</button>
    </div>

    <!-- 右：結果＋青木家＋保存 -->
    <div>
      <!-- 上：家計診断結果 -->
      <div class="card result-card">
        <div class="section-title">
          家計診断結果
          <span class="badge">Family Money視点</span>
        </div>

        <div class="result-header">
          <div>いまの家計バランスの目安</div>
          <div id="pill" class="pill">診断前</div>
        </div>

        <!-- メイン：年間の貯蓄額 -->
        <div id="result-saving" class="saving-rate">― 円／年</div>
        <div id="saving-note" class="metric-note">年間ベースの貯蓄額：診断後に表示されます。</div>

        <!-- 比較ボックス：あなた vs 青木家（貯蓄額） -->
        <div class="compare-box">
          <div class="compare-row header">
            <span></span>
            <span>あなた</span>
            <span>青木家の例</span>
          </div>
          <div class="compare-row">
            <span class="compare-label">年間の貯蓄額（目安）</span>
            <span id="your-rate" class="compare-your">― 円／年</span>
            <span id="aoki-rate" class="compare-aoki">― 円／年（同じ収入で計算）</span>
          </div>
        </div>

        <div id="result-type" class="result-title">
          「家計を診断する」ボタンを押すと結果がここに表示されます。
        </div>
        <div id="result-message" class="message"></div>

        <p class="small-note">
          ※ 「青木家の例」は、同じ手取り収入・ボーナスを前提にしたモデル家計です。
        </p>
      </div>

      <!-- 中：青木家モデル結果（赤枠エリア） -->
      <div class="card aoki-card">
        <div class="section-title">
          青木家モデルの家計イメージ
          <span class="badge">同じ収入で計算</span>
        </div>
        <p class="aoki-summary">
          あなたと同じ「手取り収入・ボーナス」で、青木家の支出バランスにした場合の貯蓄イメージです。
        </p>

        <div class="aoki-numbers">
          <div class="aoki-number-block">
            <div class="aoki-label">年間の貯蓄額</div>
            <div id="aoki-saving-amount" class="aoki-amount">― 円／年</div>
          </div>
          <div class="aoki-number-block">
            <div class="aoki-label">毎月の貯蓄額（目安）</div>
            <div id="aoki-saving-monthly" class="aoki-amount-sub">― 円／月</div>
          </div>
        </div>

        <p class="small-note">
          ※ 青木家モデルの支出設定：家賃5万円・光熱費1.5万円・通信費3千円・保険料5千円・食費7万円・日用品1.5万円・子ども費1万円・その他5万円（2人目が生まれた頃の実績ベース）。
        </p>
      </div>

      <!-- 下：結果の保存・送信（別枠） -->
      <div class="card">
        <div class="share-card-title">結果の保存・受け取り</div>
        <p class="share-card-note">
          診断結果をPDFで保存したり、メールで受け取ることができます。
        </p>
        <div class="actions-row">
          <button class="btn-sub" onclick="downloadPDF()">結果をPDFで保存</button>
          <button class="btn-sub" onclick="sendResultByEmail()">結果をメールで受け取る</button>
        </div>
        <p class="small-note">
          ※ PDFは新しいタブで開きます。ブラウザのダウンロードボタンから保存できます。<br>
          ※ メール送信は外部サービス（Google Apps Scriptなど）と連携して動きます。
        </p>
      </div>
    </div>
  </div>

<script>
  // 入力値保存用
  const STORAGE_KEY = "familymoney-kakei-v1";
  const INPUT_IDS = [
    "email",
    "income",
    "bonus",
    "rent",
    "utility",
    "phone",
    "insurance",
    "food",
    "daily",
    "child",
    "other"
  ];

  // 診断結果を保存しておく（PDF・メール用）
  let lastResult = null;

  // 青木家モデル（毎月の固定金額）
  const aokiBase = {
    rent:      50000,
    utility:   15000,
    phone:      3000,
    insurance:  5000,
    food:      70000,
    daily:     15000,
    child:     10000,
    other:     50000
  };

  // 金額表示用フォーマット
  function formatYen(value) {
    if (isNaN(value)) return "―";
    if (value < 0) {
      return "▲" + Math.abs(Math.round(value)).toLocaleString();
    }
    return Math.round(value).toLocaleString();
  }

  // 入力値の保存・読み込み
  function saveFormValues() {
    try {
      const data = {};
      INPUT_IDS.forEach(id => {
        const el = document.getElementById(id);
        if (el) data[id] = el.value;
      });
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    } catch (e) {}
  }

  function loadFormValues() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      const data = JSON.parse(raw);
      INPUT_IDS.forEach(id => {
        const el = document.getElementById(id);
        if (el && data[id] !== undefined) {
          el.value = data[id];
        }
      });
    } catch (e) {}
  }

  function clearFormValues() {
    try {
      localStorage.removeItem(STORAGE_KEY);
    } catch (e) {}
  }

  // ページ読み込み時
  window.addEventListener("DOMContentLoaded", () => {
    loadFormValues();
    document.querySelectorAll("input").forEach(el => {
      el.addEventListener("input", saveFormValues);
    });
  });

  // 家計診断ロジック
  function calculateKakei() {
    const income    = Number(document.getElementById("income").value);
    const bonus     = Number(document.getElementById("bonus").value) || 0;
    const rent      = Number(document.getElementById("rent").value);
    const utility   = Number(document.getElementById("utility").value);
    const phone     = Number(document.getElementById("phone").value);
    const insurance = Number(document.getElementById("insurance").value);
    const food      = Number(document.getElementById("food").value);
    const daily     = Number(document.getElementById("daily").value);
    const child     = Number(document.getElementById("child").value);
    const other     = Number(document.getElementById("other").value);

    if (!income || income <= 0) {
      alert("① 手取り収入（月）を入力してください。");
      return;
    }

    // 入力値を保存
    saveFormValues();

    // 年間収入
    const annualIncome = income * 12 + bonus;

    // あなたの家計（支出）
    const fixedCostUser =
      rent +
      utility +
      phone +
      insurance;

    const freeCostUser =
      food +
      daily +
      child +
      other;

    const monthlyTotalUser   = fixedCostUser + freeCostUser;
    const annualExpenseUser  = monthlyTotalUser * 12;
    const annualSavingUser   = annualIncome - annualExpenseUser;
    const monthlySavingUser  = annualSavingUser / 12;

    const savingRateUser = (annualIncome === 0)
      ? 0
      : (annualSavingUser / annualIncome * 100);

    // 青木家モデル
    const fixedCostAoki =
      aokiBase.rent +
      aokiBase.utility +
      aokiBase.phone +
      aokiBase.insurance;

    const freeCostAoki =
      aokiBase.food +
      aokiBase.daily +
      aokiBase.child +
      aokiBase.other;

    const monthlyTotalAoki   = fixedCostAoki + freeCostAoki;
    const annualExpenseAoki  = monthlyTotalAoki * 12;
    const annualSavingAoki   = annualIncome - annualExpenseAoki;
    const monthlySavingAoki  = annualSavingAoki / 12;

    const savingRateAoki = (annualIncome === 0)
      ? 0
      : (annualSavingAoki / annualIncome * 100);

    // 家計タイプ
    let type = "";
    let message = "";
    let pillClass = "pill";
    let savingNote = "";
    let pillLabel = "";

    if (savingRateUser < 5) {
      type = "タイプD：現状維持が難しい家計";
      message = "毎月とボーナスを合わせても、ほとんど貯まっていない状態かもしれません。まずは固定費（家賃・保険・通信など）の見直しから着手すると、改善の手応えが得られやすくなります。";
      pillClass += " pill-red";
      savingNote = "年間でどれくらい赤字・黒字になっているかの目安です。まずは固定費を中心に、支出の棚卸しから始めましょう。";
      pillLabel = "貯蓄の目安：要見直しゾーン";
    } else if (savingRateUser < 10) {
      type = "タイプC：あと少しで安定ゾーン";
      message = "大きな浪費はありませんが、ボーナスの使い方や、変動費のゆらぎで貯蓄が増えにくい状態かもしれません。家計の“見える化”で、安心感とコントロール感が高まりやすくなります。";
      pillClass += " pill-yellow";
      savingNote = "年間でどのくらい貯められているかの目安です。無理な節約よりも、支出の「優先順位づけ」を意識してみましょう。";
      pillLabel = "貯蓄の目安：あと少しで安定";
    } else if (savingRateUser < 20) {
      type = "タイプB：一般的に安定した家計";
      message = "ボーナスも含めて、バランスよく貯められている家計です。教育費や将来の準備を少しずつ整えることで、「安心して使えるお金」の枠がよりはっきりしていきます。";
      pillClass += " pill-yellow";
      savingNote = "年間でしっかり貯められている状態です。教育費や老後資金など、目的別に分けていくと安心が増えていきます。";
      pillLabel = "貯蓄の目安：安定ゾーン";
    } else {
      type = "タイプA：未来の安心がしっかり育つ家計";
      message = "ボーナスも含めて、お金の使い方がとても整っています。ご家族の価値観に合う支出を選びながら、「じんわりうれしい消費」にお金を回していける状態です。";
      pillClass += " pill-green";
      savingNote = "年間で十分な貯蓄ができている状態です。今後は「どう貯めるか」以上に「どう使うか」を整えていく段階です。";
      pillLabel = "貯蓄の目安：とても良い状態";
    }

    // 画面への反映
    const rateEl = document.getElementById("result-saving");
    rateEl.textContent = `${formatYen(annualSavingUser)} 円／年`;
    rateEl.className = "saving-rate";
    if (savingRateUser < 5) {
      rateEl.classList.add("rate-bad");
    } else if (savingRateUser < 20) {
      rateEl.classList.add("rate-mid");
    } else {
      rateEl.classList.add("rate-good");
    }

    document.getElementById("result-type").textContent = type;
    document.getElementById("result-message").textContent = message;
    document.getElementById("saving-note").textContent =
      `${savingNote}（月あたり約 ${formatYen(monthlySavingUser)} 円ペース）`;

    const pillEl = document.getElementById("pill");
    pillEl.className = pillClass;
    pillEl.textContent = pillLabel;

    document.getElementById("your-rate").textContent =
      `${formatYen(annualSavingUser)} 円／年`;
    document.getElementById("aoki-rate").textContent =
      `${formatYen(annualSavingAoki)} 円／年（同じ収入で計算）`;

    document.getElementById("aoki-saving-amount").textContent =
      `${formatYen(annualSavingAoki)} 円／年`;
    document.getElementById("aoki-saving-monthly").textContent =
      `${formatYen(monthlySavingAoki)} 円／月`;

    // PDF/メール用に保存
    lastResult = {
      income,
      bonus,
      annualIncome,
      fixedCostUser,
      freeCostUser,
      annualExpenseUser,
      annualSavingUser,
      monthlySavingUser,
      fixedCostAoki,
      freeCostAoki,
      annualExpenseAoki,
      annualSavingAoki,
      monthlySavingAoki,
      savingRateUser: savingRateUser.toFixed(1),
      savingRateAoki: savingRateAoki.toFixed(1),
      type,
      message
    };
  }

  // フォームのリセット
  function resetForm() {
    document.querySelectorAll("input").forEach(i => i.value = "");
    document.getElementById("result-saving").textContent = "― 円／年";
    document.getElementById("result-saving").className = "saving-rate";
    document.getElementById("saving-note").textContent =
      "年間ベースの貯蓄額：診断後に表示されます。";
    document.getElementById("result-type").textContent =
      "「家計を診断する」ボタンを押すと結果がここに表示されます。";
    document.getElementById("result-message").textContent = "";
    const pillEl = document.getElementById("pill");
    pillEl.className = "pill";
    pillEl.textContent = "診断前";
    document.getElementById("your-rate").textContent = "― 円／年";
    document.getElementById("aoki-rate").textContent = "― 円／年（同じ収入で計算）";
    document.getElementById("aoki-saving-amount").textContent = "― 円／年";
    document.getElementById("aoki-saving-monthly").textContent = "― 円／月";
    lastResult = null;
    clearFormValues();
  }

  // PDFダウンロード（新しいタブで開く）
    // PDFダウンロード（日本語対応：HTMLレンダリング）
  function downloadPDF() {
    if (!lastResult) {
      alert("先に家計を診断してください。");
      return;
    }
    if (!window.jspdf) {
      alert("PDFライブラリの読み込みに失敗しました。");
      return;
    }

    const pdfContainer = document.getElementById("pdf-content");

    // 表示用のテキストを組み立て
    const savingUserText =
      `${formatYen(lastResult.annualSavingUser)} 円／年（貯蓄率：${lastResult.savingRateUser}％）`;
    const savingAokiText =
      `${formatYen(lastResult.annualSavingAoki)} 円／年（貯蓄率：${lastResult.savingRateAoki}％）`;

    pdfContainer.innerHTML = `
      <h2 style="font-size:18px; margin:0 0 10px;">
        Family Money 家計かんたん診断 結果
      </h2>

      <p style="margin:0 0 6px;">
        手取り収入（月）：${lastResult.income.toLocaleString()} 円
      </p>
      <p style="margin:0 0 12px;">
        ボーナス（年間）：${lastResult.bonus.toLocaleString()} 円
      </p>

      <h3 style="font-size:14px; margin:10px 0 4px;">■ あなたの家計（年間）</h3>
      <p style="margin:0 0 4px;">
        固定費 合計（月）：${lastResult.fixedCostUser.toLocaleString()} 円
      </p>
      <p style="margin:0 0 4px;">
        自由費 合計（月）：${lastResult.freeCostUser.toLocaleString()} 円
      </p>
      <p style="margin:0 0 8px;">
        年間の貯蓄額　　：${savingUserText}
      </p>

      <h3 style="font-size:14px; margin:12px 0 4px;">■ 青木家モデル（同じ収入の場合・年間）</h3>
      <p style="margin:0 0 4px;">
        固定費 合計（月）：${lastResult.fixedCostAoki.toLocaleString()} 円
      </p>
      <p style="margin:0 0 4px;">
        自由費 合計（月）：${lastResult.freeCostAoki.toLocaleString()} 円
      </p>
      <p style="margin:0 0 8px;">
        年間の貯蓄額　　：${savingAokiText}
      </p>

      <h3 style="font-size:14px; margin:12px 0 4px;">■ 家計タイプ</h3>
      <p style="margin:0 0 6px;">
        ${lastResult.type}
      </p>
      <p style="margin:0;">
        コメント：${lastResult.message}
      </p>
    `;

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
      orientation: "portrait",
      unit: "pt",
      format: "a4"
    });

    doc.html(pdfContainer, {
      callback: function (doc) {
        // 新しいタブでPDFを開く
        const url = doc.output("bloburl");
        window.open(url, "_blank");
      },
      x: 40,
      y: 40,
      width: 515  // A4の横幅(約595pt)から左右マージン40ptずつ
    });
  }

  // function downloadPDF() {
  //   if (!lastResult) {
  //     alert("先に家計を診断してください。");
  //     return;
  //   }
  //   if (!window.jspdf) {
  //     alert("PDFライブラリの読み込みに失敗しました。");
  //     return;
  //   }

  //   const { jsPDF } = window.jspdf;
  //   const doc = new jsPDF();

  //   doc.setFont("helvetica", "normal");
  //   doc.setFontSize(14);
  //   doc.text("Family Money 家計かんたん診断 結果", 10, 20);

  //   doc.setFontSize(11);
  //   let y = 35;
  //   doc.text(`手取り収入（月）：${lastResult.income.toLocaleString()} 円`, 10, y); y += 8;
  //   doc.text(`ボーナス（年間）：${lastResult.bonus.toLocaleString()} 円`, 10, y); y += 8;
  //   doc.text(`年間の貯蓄額     ：${formatYen(lastResult.annualSavingUser)} 円`, 10, y); y += 6;
  //   doc.text(`（貯蓄率の目安   ：${lastResult.savingRateUser} %）`, 10, y); y += 10;

  //   doc.text("[あなたの家計（年間）]", 10, y); y += 7;
  //   doc.text(` 固定費 合計（月）      ：${lastResult.fixedCostUser.toLocaleString()} 円`, 10, y); y += 6;
  //   doc.text(` 自由費 合計（月）      ：${lastResult.freeCostUser.toLocaleString()} 円`, 10, y); y += 10;

  //   doc.text("[青木家モデル（同じ収入の場合・年間）]", 10, y); y += 7;
  //   doc.text(` 固定費 合計（月）      ：${lastResult.fixedCostAoki.toLocaleString()} 円`, 10, y); y += 6;
  //   doc.text(` 自由費 合計（月）      ：${lastResult.freeCostAoki.toLocaleString()} 円`, 10, y); y += 6;
  //   doc.text(` 年間の貯蓄額           ：${formatYen(lastResult.annualSavingAoki)} 円`, 10, y); y += 6;
  //   doc.text(`（貯蓄率の目安         ：${lastResult.savingRateAoki} %）`, 10, y); y += 10;

  //   doc.text(`あなたの家計タイプ：${lastResult.type}`, 10, y); y += 8;

  //   const msgLines = doc.splitTextToSize(`コメント：${lastResult.message}`, 180);
  //   doc.text(msgLines, 10, y);

  //   // 新しいタブでPDFを開く
  //   const pdfBlobUrl = doc.output("bloburl");
  //   window.open(pdfBlobUrl, "_blank");
  // }

  // メール送信
  function sendResultByEmail() {
    const email = document.getElementById("email").value.trim();

    if (!email) {
      alert("メールアドレスを入力してください。");
      return;
    }
    if (!lastResult) {
      alert("先に家計を診断してください。");
      return;
    }

    const ENDPOINT_URL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec";

    const payload = {
      email,
      result: lastResult,
      source: "familymoney-kakei-check"
    };

    fetch(ENDPOINT_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
      mode: "no-cors"
    }).catch(()=>{});

    alert("結果のメール送信を受け付けました。（※ Apps Script側の設定が必要です）");
  }
</script>

  <!-- PDF出力用の隠しエリア（画面には表示されません） -->
  <div id="pdf-content"
       style="position:absolute; left:-9999px; top:-9999px; width:595px;
              font-family:'Noto Sans JP', system-ui, sans-serif;
              font-size:12px; line-height:1.6;">
  </div>
  
</body>
</html>
