<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Family Money｜簡単ライフシミュレーション</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Chart.js（グラフ用） -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* ------------- レイアウト共通 ------------- */
    html {
      box-sizing: border-box;
    }
    *, *::before, *::after {
      box-sizing: inherit;
    }

    body {
      font-family: "Noto Sans JP", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
      background: #faf8f5;
      padding: 24px;
      line-height: 1.6;
      color: #333;
    }

    h1 {
      font-size: 24px;
      text-align: center;
      margin-bottom: 8px;
    }

    .sub-title {
      text-align: center;
      font-size: 13px;
      color: #777;
      margin-bottom: 20px;
    }

    .layout {
      max-width: 960px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.9fr);
      gap: 16px;
      align-items: flex-start;
    }

    @media (max-width: 768px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0px 4px 12px rgba(0,0,0,0.08);
      border: 1px solid #eee0cf;
    }

    .section-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #f5e3cc;
      color: #b57a3f;
      font-weight: 600;
    }

    label {
      font-weight: 600;
      margin-top: 12px;
      display: block;
      font-size: 13px;
    }

    .hint {
      font-size: 11px;
      color: #777;
    }

    input {
      width: 100%;
      max-width: 100%;
      padding: 8px;
      margin-top: 4px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 14px;
      background: #fdfaf6;
    }

    input:focus {
      outline: none;
      border-color: #f2a25c;
      box-shadow: 0 0 0 2px rgba(242,162,92,0.25);
      background: #fff;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 10px;
    }

    @media (max-width: 600px) {
      .grid-2 {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .group-box {
      margin-top: 16px;
      padding: 12px 12px 10px;
      border-radius: 12px;
      border: 1px dashed #e0d3c2;
      background: #fdf9f3;
    }

    .group-title {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .group-tag {
      font-size: 11px;
      padding: 1px 7px;
      border-radius: 999px;
      background: #f7e6cf;
      color: #a16b2f;
      font-weight: 600;
    }

    button {
      width: 100%;
      margin-top: 16px;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-main {
      background: #f4a460;
      color: white;
    }

    .btn-reset {
      background: #e3ded8;
      color: #444;
    }

    .btn-sub {
      width: auto;
      padding: 8px 14px;
      font-size: 13px;
      background: #fff;
      border: 1px solid #e0d3c2;
      color: #555;
      border-radius: 999px;
      cursor: pointer;
    }

    /* --------- 結果カード ---------- */
    .result-card {
      margin-bottom: 16px;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .pill {
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid #e0d3c2;
      background: #fdfaf6;
      white-space: nowrap;
    }

    .pill-green {
      border-color: #4e9b6a;
      color: #2d6d44;
      background: #ecf7f0;
    }

    .pill-yellow {
      border-color: #e8b249;
      color: #9a720e;
      background: #fff7df;
    }

    .pill-red {
      border-color: #d66a6a;
      color: #8c2f2f;
      background: #ffecec;
    }

    .saving-rate {
      font-size: 28px;
      font-weight: 800;
      margin: 4px 0 4px;
    }

    .rate-good { color: #2e8b57; }
    .rate-mid  { color: #d29122; }
    .rate-bad  { color: #c64545; }

    .metric-note {
      font-size: 12px;
      color: #777;
      margin-bottom: 8px;
    }

    .small-note {
      margin-top: 8px;
      font-size: 11px;
      color: #888;
    }

    /* 診断タイプ・メッセージを強調 */
    #result-type {
      font-size: 20px;
      font-weight: 800;
      color: #8b5a2b;
      margin-top: 12px;
      margin-bottom: 6px;
    }

    #result-message {
      font-size: 15px;
      line-height: 1.7;
      color: #555;
      margin-top: 4px;
    }

    .actions-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    /* --------- 青木家モデル ---------- */
    .aoki-card {
      margin-bottom: 16px;
      border-style: dashed;
      border-color: #f4a460;
      background: #fffaf2;
    }

    .aoki-summary {
      font-size: 12px;
      color: #555;
      margin-bottom: 10px;
    }

    .aoki-numbers {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 8px;
    }

    .aoki-number-block {
      flex: 1 1 120px;
      min-width: 0;
    }

    .aoki-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }

    .aoki-amount {
      font-size: 22px;
      font-weight: 800;
      color: #2e8b57;
    }

    .aoki-amount-sub {
      font-size: 16px;
      font-weight: 700;
      color: #6e5b3a;
    }

    /* --------- グラフカード（フル幅） ---------- */
    .chart-wrapper {
      max-width: 960px;
      margin: 24px auto 0;
    }

    .chart-card {
      height: 420px; /* グラフを大きめに表示 */
    }

    .chart-note {
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }

    #projectionChart {
      width: 100% !important;
      height: 320px !important; /* カード内で見やすい高さ */
    }
  </style>
</head>

<body>
  <h1>Family Money｜簡単ライフシミュレーション</h1>
  <p class="sub-title">40代・晩産夫婦向け。毎月の家計から「いま」と「30年先」のイメージをざっくり確認できます。</p>

  <div class="layout">
    <!-- 左：入力カード -->
    <div class="card">
      <div class="section-title">
        毎月の家計をざっくり入力
        <span class="badge">1〜2分でOK</span>
      </div>

      <label>メールアドレス（結果を受け取りたい方のみ）</label>
      <input id="email" type="email" placeholder="例：family@example.com">
      <div class="hint">※ 入力しなくても診断はできます。</div>

      <label>① 手取り収入（月）</label>
      <input id="income" type="number" placeholder="例：350000">

      <label>①-2 ボーナス（年間・手取り）</label>
      <input id="bonus" type="number" placeholder="例：400000">

      <label>② 利回り（年率・％）</label>
      <input id="returnRate" type="number" placeholder="例：3">

      <label>あなたの年齢</label>
      <input id="age" type="number" placeholder="例：40">
      <div class="hint">※ グラフの「1年目」が現在の年齢になります。</div>

      <!-- 固定費グループ -->
      <div class="group-box">
        <div class="group-title">
          必要なお金（固定費）
          <span class="group-tag">家を守るための支出</span>
        </div>
        <div class="grid-2">
          <div>
            <label>家賃 / 住宅費</label>
            <input id="rent" type="number">
          </div>
          <div>
            <label>光熱費</label>
            <input id="utility" type="number">
          </div>
        </div>
        <div class="grid-2">
          <div>
            <label>通信費（スマホ・ネット）</label>
            <input id="phone" type="number">
          </div>
          <div>
            <label>保険料</label>
            <input id="insurance" type="number">
          </div>
        </div>
      </div>

      <!-- 変動費グループ -->
      <div class="group-box">
        <div class="group-title">
          自由に使うお金（変動費）
          <span class="group-tag">暮らしを彩る支出</span>
        </div>
        <div class="grid-2">
          <div>
            <label>食費</label>
            <input id="food" type="number">
          </div>
          <div>
            <label>日用品</label>
            <input id="daily" type="number">
          </div>
        </div>
        <div class="grid-2">
          <div>
            <label>子ども費</label>
            <input id="child" type="number">
          </div>
          <div>
            <label>その他の支出</label>
            <input id="other" type="number">
          </div>
        </div>
      </div>

      <button class="btn-main" onclick="calculateKakei()">家計を診断する</button>
      <button class="btn-reset" onclick="resetForm()">リセット</button>
    </div>

    <!-- 右：結果＋青木家＋保存 -->
    <div>
      <!-- 上：家計診断結果 -->
      <div class="card result-card">
        <div class="section-title">
          家計診断結果
          <span class="badge">Family Money視点</span>
        </div>

        <div class="result-header">
          <div>いまの年間の貯蓄額の目安</div>
          <div id="pill" class="pill">診断前</div>
        </div>

        <div id="result-saving" class="saving-rate">― 円／年</div>
        <div id="saving-note" class="metric-note">
          年間ベースの貯蓄額：診断後に表示されます。
        </div>

        <div id="result-type">
          「家計を診断する」ボタンを押すと結果がここに表示されます。
        </div>
        <div id="result-message"></div>

        <p class="small-note">
          ※ マイナスの場合は「▲」付きで表示されます。<br>
          ※ 年間の貯蓄額をベースに、30年先までのシミュレーションを行います。
        </p>
      </div>

      <!-- 中：青木家モデル結果 -->
      <div class="card aoki-card">
        <div class="section-title">
          青木家モデルの家計イメージ
          <span class="badge">同じ収入で計算</span>
        </div>
        <p class="aoki-summary">
          あなたと同じ「手取り収入・ボーナス」で、青木家の支出バランスにした場合の貯蓄イメージです。
        </p>

        <div class="aoki-numbers">
          <div class="aoki-number-block">
            <div class="aoki-label">年間の貯蓄額（目安）</div>
            <div id="aoki-saving-amount" class="aoki-amount">― 円／年</div>
          </div>
          <div class="aoki-number-block">
            <div class="aoki-label">毎月の貯蓄額（目安）</div>
            <div id="aoki-saving-monthly" class="aoki-amount-sub">― 円／月</div>
          </div>
        </div>

        <p class="small-note">
          ※ 青木家モデルの支出設定：家賃5万円・光熱費1.5万円・通信費3千円・保険料5千円・食費7万円・日用品1.5万円・子ども費1万円・その他5万円（2人目が生まれた頃の実績ベース）。
        </p>
      </div>

      <!-- 保存・メール -->
      <div class="card">
        <div class="section-title">
          結果の保存・受け取り
        </div>
        <p class="small-note">
          診断結果を印刷用ページで表示したり、メールで受け取ることができます。
        </p>
        <div class="actions-row">
          <button class="btn-sub" onclick="openPrintView()">結果をPDFで保存</button>
          <button class="btn-sub" onclick="sendResultByEmail()">結果をメールで受け取る</button>
        </div>
        <p class="small-note">
          ※ PDFはブラウザの「印刷→PDFに保存」をご利用ください。<br>
          ※ メール送信は外部サービス（Google Apps Scriptなど）と連携して動きます。
        </p>
      </div>
    </div>
  </div>

  <!-- ▼▼▼ グラフは layout の外に出してフル幅表示 ▼▼▼ -->
  <div class="chart-wrapper">
    <div class="card chart-card">
      <div class="section-title">
        30年先までの貯蓄シミュレーション
      </div>
      <p class="chart-note">
        利回りや家計の見直しによって、将来の貯蓄イメージがどのように変化するかをざっくり確認できます。
      </p>
      <canvas id="projectionChart"></canvas>
    </div>
  </div>

<script>
  /* ========= 入力値の保存 ========= */
  const STORAGE_KEY = "familymoney-life-sim-v1";
  const INPUT_IDS = [
    "email",
    "income",
    "bonus",
    "returnRate",
    "age",
    "rent",
    "utility",
    "phone",
    "insurance",
    "food",
    "daily",
    "child",
    "other"
  ];

  let lastResult = null;
  let projectionChart = null;

  const aokiBase = {
    rent:      50000,
    utility:   15000,
    phone:      3000,
    insurance:  5000,
    food:      70000,
    daily:     15000,
    child:     10000,
    other:     50000
  };

  function formatYen(value) {
    if (isNaN(value)) return "―";
    if (value < 0) {
      return "▲" + Math.abs(Math.round(value)).toLocaleString();
    }
    return Math.round(value).toLocaleString();
  }

  function saveFormValues() {
    try {
      const data = {};
      INPUT_IDS.forEach(id => {
        const el = document.getElementById(id);
        if (el) data[id] = el.value;
      });
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    } catch (e) {}
  }

  function loadFormValues() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      const data = JSON.parse(raw);
      INPUT_IDS.forEach(id => {
        const el = document.getElementById(id);
        if (el && data[id] !== undefined) {
          el.value = data[id];
        }
      });
    } catch (e) {}
  }

  function clearFormValues() {
    try {
      localStorage.removeItem(STORAGE_KEY);
    } catch (e) {}
  }

  window.addEventListener("DOMContentLoaded", () => {
    loadFormValues();
    document.querySelectorAll("input").forEach(el => {
      el.addEventListener("input", saveFormValues);
    });

    const incomeVal = Number(document.getElementById("income").value);
    if (incomeVal) {
      calculateKakei();
    }
  });

  /* ========= 家計診断ロジック ========= */
  function calculateKakei() {
    const income    = Number(document.getElementById("income").value);
    const bonus     = Number(document.getElementById("bonus").value) || 0;
    const rateInput = Number(document.getElementById("returnRate").value) || 0;
    const age       = Number(document.getElementById("age").value) || 0;

    const rent      = Number(document.getElementById("rent").value);
    const utility   = Number(document.getElementById("utility").value);
    const phone     = Number(document.getElementById("phone").value);
    const insurance = Number(document.getElementById("insurance").value);
    const food      = Number(document.getElementById("food").value);
    const daily     = Number(document.getElementById("daily").value);
    const child     = Number(document.getElementById("child").value);
    const other     = Number(document.getElementById("other").value);

    if (!income || income <= 0) {
      alert("① 手取り収入（月）を入力してください。");
      return;
    }

    saveFormValues();

    const annualIncome = income * 12 + bonus;

    const fixedCostUser = rent + utility + phone + insurance;
    const freeCostUser  = food + daily + child + other;

    const monthlyTotalUser   = fixedCostUser + freeCostUser;
    const annualExpenseUser  = monthlyTotalUser * 12;
    const annualSavingUser   = annualIncome - annualExpenseUser;
    const monthlySavingUser  = annualSavingUser / 12;

    const savingRateUser =
      annualIncome === 0 ? 0 : (annualSavingUser / annualIncome * 100);

    const fixedCostAoki =
      aokiBase.rent + aokiBase.utility + aokiBase.phone + aokiBase.insurance;
    const freeCostAoki =
      aokiBase.food + aokiBase.daily + aokiBase.child + aokiBase.other;

    const monthlyTotalAoki   = fixedCostAoki + freeCostAoki;
    const annualExpenseAoki  = monthlyTotalAoki * 12;
    const annualSavingAoki   = annualIncome - annualExpenseAoki;
    const monthlySavingAoki  = annualSavingAoki / 12;

    const savingRateAoki =
      annualIncome === 0 ? 0 : (annualSavingAoki / annualIncome * 100);

    let type = "";
    let message = "";
    let pillClass = "pill";
    let savingNote = "";
    let pillLabel = "";

    if (savingRateUser < 5) {
      type = "タイプD：現状維持が難しい家計";
      message =
        "毎月とボーナスを合わせても、ほとんど貯まっていない状態かもしれません。まずは固定費（家賃・保険・通信など）の見直しから着手すると、改善の手応えが得られやすくなります。";
      pillClass += " pill-red";
      savingNote =
        "年間でどれくらい赤字・黒字になっているかの目安です。まずは固定費を中心に、支出の棚卸しから始めましょう。";
      pillLabel = "貯蓄の目安：要見直しゾーン";
    } else if (savingRateUser < 10) {
      type = "タイプC：あと少しで安定ゾーン";
      message =
        "大きな浪費はありませんが、ボーナスの使い方や、変動費のゆらぎで貯蓄が増えにくい状態かもしれません。家計の“見える化”で、安心感とコントロール感が高まりやすくなります。";
      pillClass += " pill-yellow";
      savingNote =
        "年間でどのくらい貯められているかの目安です。無理な節約よりも、支出の「優先順位づけ」を意識してみましょう。";
      pillLabel = "貯蓄の目安：あと少しで安定";
    } else if (savingRateUser < 20) {
      type = "タイプB：一般的に安定した家計";
      message =
        "ボーナスも含めて、バランスよく貯められている家計です。教育費や将来の準備を少しずつ整えることで、「安心して使えるお金」の枠がよりはっきりしていきます。";
      pillClass += " pill-yellow";
      savingNote =
        "年間でしっかり貯められている状態です。教育費や老後資金など、目的別に分けていくと安心が増えていきます。";
      pillLabel = "貯蓄の目安：安定ゾーン";
    } else {
      type = "タイプA：未来の安心がしっかり育つ家計";
      message =
        "ボーナスも含めて、お金の使い方がとても整っています。ご家族の価値観に合う支出を選びながら、「じんわりうれしい消費」にお金を回していける状態です。";
      pillClass += " pill-green";
      savingNote =
        "年間で十分な貯蓄ができている状態です。今後は「どう貯めるか」以上に「どう使うか」を整えていく段階です。";
      pillLabel = "貯蓄の目安：とても良い状態";
    }

    const rateEl = document.getElementById("result-saving");
    rateEl.textContent = `${formatYen(annualSavingUser)} 円／年`;
    rateEl.className = "saving-rate";
    if (savingRateUser < 5) {
      rateEl.classList.add("rate-bad");
    } else if (savingRateUser < 20) {
      rateEl.classList.add("rate-mid");
    } else {
      rateEl.classList.add("rate-good");
    }

    document.getElementById("result-type").textContent = type;
    document.getElementById("result-message").textContent = message;
    document.getElementById("saving-note").textContent =
      `${savingNote}（月あたり約 ${formatYen(monthlySavingUser)} 円ペース）`;

    const pillEl = document.getElementById("pill");
    pillEl.className = pillClass;
    pillEl.textContent = pillLabel;

    document.getElementById("aoki-saving-amount").textContent =
      `${formatYen(annualSavingAoki)} 円／年`;
    document.getElementById("aoki-saving-monthly").textContent =
      `${formatYen(monthlySavingAoki)} 円／月`;

    lastResult = {
      income,
      bonus,
      annualIncome,
      annualExpenseUser,
      annualSavingUser,
      monthlySavingUser,
      annualExpenseAoki,
      annualSavingAoki,
      monthlySavingAoki,
      savingRateUser: savingRateUser.toFixed(1),
      savingRateAoki: savingRateAoki.toFixed(1),
      type,
      message,
      rateInput,
      age
    };

    updateProjectionChart(annualSavingUser, annualSavingAoki, rateInput, age);
  }

  /* ========= グラフ更新 ========= */
  function updateProjectionChart(annualSavingUser, annualSavingAoki, ratePercent, age) {
    const rate = ratePercent / 100;

    const labels = [];
    const userAnnual = [];
    const aokiAnnual = [];
    const userTotal = [];
    const aokiTotal = [];

    let totalUser = 0;
    let totalAoki = 0;

    for (let i = 0; i < 30; i++) {
      const labelAge = age > 0 ? `${age + i}歳` : `${i + 1}年目`;
      labels.push(labelAge);

      totalUser = totalUser * (1 + rate) + annualSavingUser;
      totalAoki = totalAoki * (1 + rate) + annualSavingAoki;

      userAnnual.push(annualSavingUser);
      aokiAnnual.push(annualSavingAoki);
      userTotal.push(totalUser);
      aokiTotal.push(totalAoki);
    }

    const ctx = document.getElementById("projectionChart").getContext("2d");

    if (projectionChart) {
      projectionChart.destroy();
    }

    projectionChart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: labels,
        datasets: [
          {
            type: "bar",
            label: "あなたの年間貯蓄額",
            data: userAnnual,
            backgroundColor: "rgba(244,164,96,0.6)"
          },
          {
            type: "bar",
            label: "青木家モデルの年間貯蓄額",
            data: aokiAnnual,
            backgroundColor: "rgba(190,158,130,0.5)"
          },
          {
            type: "line",
            label: "あなたの累計資産",
            data: userTotal,
            borderColor: "rgba(244,164,96,1)",
            borderWidth: 2,
            fill: false,
            tension: 0.2,
            yAxisID: "y"
          },
          {
            type: "line",
            label: "青木家モデルの累計資産",
            data: aokiTotal,
            borderColor: "rgba(150,120,90,1)",
            borderWidth: 2,
            fill: false,
            tension: 0.2,
            yAxisID: "y"
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function (value) {
                return (value / 10000).toLocaleString() + " 万円";
              }
            }
          },
          x: {
            ticks: {
              maxRotation: 0,
              minRotation: 0
            }
          }
        },
        plugins: {
          legend: {
            position: "bottom",
            labels: {
              boxWidth: 16,
              font: { size: 10 }
            }
          },
          tooltip: {
            callbacks: {
              label: function (ctx) {
                const v = ctx.parsed.y;
                return `${ctx.dataset.label}: ${formatYen(v)} 円`;
              }
            }
          }
        }
      }
    });
  }

  /* ========= フォームリセット ========= */
  function resetForm() {
    document.querySelectorAll("input").forEach(i => (i.value = ""));
    document.getElementById("result-saving").textContent = "― 円／年";
    document.getElementById("result-saving").className = "saving-rate";
    document.getElementById("saving-note").textContent =
      "年間ベースの貯蓄額：診断後に表示されます。";
    document.getElementById("result-type").textContent =
      "「家計を診断する」ボタンを押すと結果がここに表示されます。";
    document.getElementById("result-message").textContent = "";
    const pillEl = document.getElementById("pill");
    pillEl.className = "pill";
    pillEl.textContent = "診断前";
    document.getElementById("aoki-saving-amount").textContent = "― 円／年";
    document.getElementById("aoki-saving-monthly").textContent = "― 円／月";

    if (projectionChart) {
      projectionChart.destroy();
      projectionChart = null;
    }
    lastResult = null;
    clearFormValues();
  }

  /* ========= 印刷 / PDF ========= */
  function openPrintView() {
    if (!lastResult) {
      alert("先に家計を診断してください。");
      return;
    }

    const win = window.open("", "_blank");
    if (!win) return;

    const savingUserText =
      `${formatYen(lastResult.annualSavingUser)} 円／年（貯蓄率：${lastResult.savingRateUser}％）`;
    const savingAokiText =
      `${formatYen(lastResult.annualSavingAoki)} 円／年（貯蓄率：${lastResult.savingRateAoki}％）`;

    win.document.write(`
      <!DOCTYPE html>
      <html lang="ja">
      <head>
        <meta charset="UTF-8">
        <title>Family Money｜簡単ライフシミュレーション 結果</title>
        <style>
          body {
            font-family: "Noto Sans JP", system-ui, sans-serif;
            padding: 24px;
            line-height: 1.6;
            color: #333;
          }
          h1 {
            font-size: 20px;
            margin-bottom: 8px;
          }
          h2 {
            font-size: 16px;
            margin: 16px 0 4px;
          }
          p { margin: 0 0 6px; }
          .small { font-size: 11px; color: #666; }
        </style>
      </head>
      <body>
        <h1>Family Money｜簡単ライフシミュレーション 結果</h1>

        <h2>1. 基本情報</h2>
        <p>手取り収入（月）：${lastResult.income.toLocaleString()} 円</p>
        <p>ボーナス（年間）：${lastResult.bonus.toLocaleString()} 円</p>
        <p>利回り（年率）：${lastResult.rateInput || 0}%</p>

        <h2>2. あなたの家計</h2>
        <p>年間の貯蓄額：${savingUserText}</p>
        <p>家計タイプ：${lastResult.type}</p>
        <p>コメント：${lastResult.message}</p>

        <h2>3. 青木家モデル（同じ収入の場合）</h2>
        <p>年間の貯蓄額：${savingAokiText}</p>

        <p class="small">
          ※ 本シミュレーションは参考値です。実際の税金・社会保険料・物価変動などは考慮していません。
        </p>

        <script>
          window.onload = function() {
            window.print();
          };
        <\/script>
      </body>
      </html>
    `);
    win.document.close();
  }

  /* ========= メール送信 ========= */
  function sendResultByEmail() {
    const email = document.getElementById("email").value.trim();

    if (!email) {
      alert("メールアドレスを入力してください。");
      return;
    }
    if (!lastResult) {
      alert("先に家計を診断してください。");
      return;
    }

    const ENDPOINT_URL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec";

    const payload = {
      email,
      result: lastResult,
      source: "familymoney-life-simulation"
    };

    fetch(ENDPOINT_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
      mode: "no-cors"
    }).catch(() => {});

    alert("結果のメール送信を受け付けました。（※ Apps Script側の設定が必要です）");
  }
</script>
</body>
</html>
